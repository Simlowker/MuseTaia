apiVersion: apps/v1
kind: Deployment
metadata:
  name: smos-golden-agent
spec:
  replicas: 1
  selector:
    matchLabels:
      app: smos-golden
  template:
    metadata:
      labels:
        app: smos-golden
      annotations:
        # Crucial: Enable GKE Checkpointing for this Pod
        gke.io/pod-checkpointing: "true"
    spec:
      runtimeClassName: smos-criu-runtime
      containers:
      - name: golden-agent
        image: us-central1-docker.pkg.dev/muse-taia/smos-repo/smos-agent:latest
        lifecycle:
          postStart:
            exec:
              command: ["/bin/sh", "-c", "python scripts/bootstrap_dna.py"]
        # Readiness probe used by Go Dispatcher to trigger snapshot
        readinessProbe:
          httpGet:
            path: /internal/checkpoint-ready
            port: 8000
          initialDelaySeconds: 15
          periodSeconds: 5